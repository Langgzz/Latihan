<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Include interactive_faq CSS into website frontend assets -->
    <template id="assets_frontend_interactive_faq" inherit_id="website.assets_frontend" name="interactive_faq assets">
        <xpath expr="." position="inside">
            <link rel="stylesheet" type="text/css" href="/interactive_faq/static/src/css/faq.css"/>
        </xpath>
    </template>

    <template id="faq_page" name="FAQ Page">
        <t t-call="website.layout">
            <div class="container faq-container py-5">
                <div class="text-center mb-5">
                    <h1 class="display-4 mb-2">FAQ Odoo Helpdesk</h1>
                    <p class="lead text-muted">Temukan jawaban untuk pertanyaan umum tentang Helpdesk</p>
                </div>

                <!-- Search Bar -->
                <div class="row justify-content-center mb-5">
                    <div class="col-12 col-md-8">
                        <div class="input-group faq-search-input-group">
                            <input type="text" class="form-control" id="faq-search" 
                                placeholder="Cari pertanyaan atau topik..."
                                autocomplete="off"/>
                            <div class="input-group-append">
                                <span class="input-group-text">
                                    <i class="fa fa-search"/>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Category Buttons -->
                <div class="row justify-content-center mb-5">
                    <div class="col-12 text-center">
                        <button class="btn category-btn m-1 active" data-category="all">
                            Semua
                        </button>
                        <t t-foreach="categories" t-as="category">
                            <button class="btn category-btn m-1" 
                                t-att-data-category="category.id">
                                <t t-if="category.icon">
                                    <i t-att-class="category.icon + ' mr-1'"/>
                                </t>
                                <t t-esc="category.name"/>
                            </button>
                        </t>
                    </div>
                </div>

                <!-- FAQ Items -->
                <div class="row justify-content-center">
                    <div class="col-12 col-md-10">
                        <div class="accordion" id="faqAccordion">
                            <t t-foreach="faqs" t-as="faq">
                                <div class="card faq-item" t-att-data-category="faq.category_id.id">
                                    <div class="card-header" t-att-id="'faqHeading%s' % faq.id">
                                        <h2 class="mb-0">
                                            <button class="btn btn-link btn-block text-left faq-question collapsed" 
                                                type="button" 
                                                data-toggle="collapse" 
                                                t-att-data-target="'#faqCollapse%s' % faq.id"
                                                aria-expanded="false">
                                                <t t-esc="faq.name"/>
                                            </button>
                                        </h2>
                                    </div>
                                    <div t-att-id="'faqCollapse%s' % faq.id" 
                                        class="collapse faq-answer"
                                        t-att-aria-labelledby="'faqHeading%s' % faq.id"
                                        data-parent="#faqAccordion">
                                        <div class="card-body">
                                            <t t-raw="faq.answer"/>
                                        </div>
                                    </div>
                                </div>
                            </t>
                        </div>
                        
                        <!-- No Results Message -->
                        <div class="no-results mt-4">
                            <i class="fa fa-search fa-3x mb-3 text-muted"></i>
                            <h4>Tidak ada hasil ditemukan</h4>
                            <p>Coba gunakan kata kunci lain.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Inline JavaScript for immediate functionality -->
            <script type="text/javascript">
                $(document).ready(function() {
                    // Search functionality
                    $('#faq-search').on('input', function() {
                        var searchValue = $(this).val().toLowerCase();
                        var hasResults = false;
                        
                        $('.faq-item').each(function() {
                            var $faq = $(this);
                            var question = $faq.find('.faq-question').text().toLowerCase();
                            var answer = $faq.find('.card-body').text().toLowerCase();
                            
                            if (question.indexOf(searchValue) > -1 || answer.indexOf(searchValue) > -1) {
                                $faq.show();
                                hasResults = true;
                            } else {
                                $faq.hide();
                            }
                        });

                        if (!hasResults &amp;&amp; searchValue.length > 0) {
                            $('.no-results').addClass('active');
                        } else {
                            $('.no-results').removeClass('active');
                        }
                    });

                    // Category filter functionality
                    $('.category-btn').click(function(e) {
                        e.preventDefault();
                        var selectedCategory = $(this).data('category');
                        
                        // Update active button
                        $('.category-btn').removeClass('active');
                        $(this).addClass('active');
                        
                        // Filter FAQ items
                        if (selectedCategory === 'all') {
                            $('.faq-item').fadeIn(200);
                        } else {
                            $('.faq-item').each(function() {
                                var $faq = $(this);
                                if ($faq.data('category') == selectedCategory) {
                                    $faq.fadeIn(200);
                                } else {
                                    $faq.hide();
                                }
                            });
                        }
                    });
                });
            </script>
        </t>
    </template>
</odoo>
